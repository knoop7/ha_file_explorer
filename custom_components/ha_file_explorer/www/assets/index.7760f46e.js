var J=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var R=(l,e,i)=>e in l?J(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i,w=(l,e)=>{for(var i in e||(e={}))X.call(e,i)&&R(l,i,e[i]);if(q)for(var i of q(e))Y.call(e,i)&&R(l,i,e[i]);return l},z=(l,e)=>Q(l,W(e));import{d as A,r as E,a as n,o as p,c as g,w as t,b as a,e as x,f as P,g as S,F as j,h as _,u as D,t as o,i as d,j as Z,k as H,l as B,m as ee,n as T,p as K,q as N,_ as te}from"./index.407abd14.js";import{l as s,_ as ae}from"./AppLayout.dc0bb97a.js";const ne={class:"va-table"},le=["href"],oe={key:1},se=_(" OK "),ie=A({name:"VersionInfo",props:["ok"],setup(l){const e=l;D();const i="File Explorer",u=E(!0),$=new URLSearchParams(location.search),L=E([{name:"Version",value:$.get("v")||"dev"},{name:"Author",value:"shaonianzhentan"},{name:"Link",value:"https://github.com/shaonianzhentan/ha_file_explorer",type:"link"},{name:"UI",value:"https://vuestic.dev",type:"link"},{name:"Icon",value:"https://unpkg.com/@mdi/font@latest/preview.html",type:"link"},{name:"Bilibili",value:"https://space.bilibili.com/39523884",type:"link"},{name:"HA notes",value:"https://ha.jiluxinqing.com",type:"link"}]),v=async()=>{e.ok({})};return(h,f)=>{const k=n("va-button"),y=n("va-modal");return p(),g(y,{modelValue:u.value,"onUpdate:modelValue":f[0]||(f[0]=c=>u.value=c),title:i,"hide-default-actions":!0},{footer:t(()=>[a(k,{onClick:v},{default:t(()=>[se]),_:1})]),default:t(()=>[x("table",ne,[x("tbody",null,[(p(!0),P(j,null,S(L.value,c=>(p(),P("tr",{key:c.name},[x("td",null,o(c.name),1),x("td",null,[c.type==="link"?(p(),P("a",{key:0,href:c.value,target:"_blank"},o(c.value),9,le)):(p(),P("span",oe,o(c.value),1))])]))),128))])])]),_:1},8,["modelValue"])}}}),ce={},M=A(z(w({},ce),{name:"CreateFile",props:["type","ok","cancel","app"],setup(l){const e=l,i=D(),u=e.type==="file",$=u?s.file:s.folder,L=e.app(),v=E(""),h=E(!0),f=()=>{e.cancel()},k=async()=>{if(!v.value)return;const y=i.getters.absolutePath(v.value);let c=await H.service.createHassFile(u?"file":"folder",y);L.$toast(c.msg),!(c.code>0)&&(i.dispatch("reloadFileList"),e.ok({}))};return(y,c)=>{const r=n("va-input"),m=n("va-button"),b=n("va-modal");return p(),g(b,{modelValue:h.value,"onUpdate:modelValue":c[1]||(c[1]=V=>h.value=V),title:d($),"hide-default-actions":!0},{footer:t(()=>[a(m,{outline:"",onClick:f,style:{"margin-right":"20px"}},{default:t(()=>[_(o(d(s).cancel),1)]),_:1}),a(m,{onClick:k,style:{"margin-left":"20px"}},{default:t(()=>[_(o(d(s).confirm),1)]),_:1})]),default:t(()=>[a(r,{modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=V=>v.value=V),modelModifiers:{trim:!0},onKeypress:Z(k,["enter"]),placeholder:d(s).newName(d($))},null,8,["modelValue","onKeypress","placeholder"])]),_:1},8,["modelValue","title"])}}})),ue={},O=A(z(w({},ue),{name:"UploadFile",props:["type","ok","cancel","app"],setup(l){const e=l,i=D(),u=e.type==="file",$=`${s.upload} ${u?s.file:s.folder}`,L=e.app(),v=E([]),h=E(!0),f=E(!1),k=r=>{const m=[];for(let b of r.target.files)m.push(b);v.value=m},y=()=>{e.cancel()},c=async()=>{v.value.length!==0&&(f.value=!0,Promise.all(v.value.map(r=>{const m=i.getters.absolutePath(u?r.name:r.webkitRelativePath);return H.service.uploadFile(m,r)})).then(r=>{L.$toast(`\u6210\u529F\u4E0A\u4F20${r.length}\u6587\u4EF6`),i.dispatch("reloadFileList"),e.ok({}),f.value=!1}))};return(r,m)=>{const b=n("va-progress-bar"),V=n("va-alert"),F=n("va-file-upload"),C=n("va-button"),U=n("va-modal");return p(),g(U,{modelValue:h.value,"onUpdate:modelValue":m[1]||(m[1]=I=>h.value=I),title:$,"hide-default-actions":!0},{footer:t(()=>[a(C,{disabled:f.value,outline:"",onClick:y,style:{"margin-right":"20px"}},{default:t(()=>[_(o(d(s).cancel),1)]),_:1},8,["disabled"]),a(C,{disabled:f.value,onClick:c,style:{"margin-left":"20px"}},{default:t(()=>[_(o(d(s).confirm),1)]),_:1},8,["disabled"])]),default:t(()=>[f.value?(p(),g(b,{key:0,indeterminate:""})):B("",!0),a(V,{color:"danger",class:"mb-4"},{default:t(()=>[_(o(d(s).uploadTips),1)]),_:1}),u?(p(),g(F,{key:1,disabled:f.value,modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=I=>v.value=I)},null,8,["disabled","modelValue"])):(p(),P("input",{key:2,type:"file",onChange:k,webkitdirectory:""},null,32))]),_:1},8,["modelValue"])}}})),re={},G=A(z(w({},re),{name:"RenameFile",props:["type","name","ok","cancel","app"],setup(l){const e=l,i=D(),u=e.type==="file",$=u?s.file:s.folder,L=ee(()=>{if(u)return e.name;const r=i.getters.absolutePath(e.name).split("/");return r.splice(r.length-1,1),r[r.length-1]}),v=e.app(),h=E(""),f=E(!0),k=()=>{e.cancel()},y=async()=>{if(!h.value)return;let c=i.getters.absolutePath(e.name),r=i.getters.absolutePath(h.value);if(!u){const b=c.split("/");b.splice(b.length-1,1),c=b.join("/"),b[b.length-1]=h.value,r=b.join("/")}let m=await H.service.rename(c,r);v.$toast(m.msg),!(m.code>0)&&(i.dispatch("reloadFileList",u?"":r),e.ok({}))};return(c,r)=>{const m=n("va-alert"),b=n("va-input"),V=n("va-button"),F=n("va-modal");return p(),g(F,{modelValue:f.value,"onUpdate:modelValue":r[1]||(r[1]=C=>f.value=C),title:d($),"hide-default-actions":!0},{footer:t(()=>[a(V,{outline:"",onClick:k,style:{"margin-right":"20px"}},{default:t(()=>[_(o(d(s).cancel),1)]),_:1}),a(V,{onClick:y,style:{"margin-left":"20px"}},{default:t(()=>[_(o(d(s).confirm),1)]),_:1})]),default:t(()=>[a(m,{outline:""},{default:t(()=>[_(o(d(s).currentName)+"\uFF1A"+o(d(L)),1)]),_:1}),a(b,{modelValue:h.value,"onUpdate:modelValue":r[0]||(r[0]=C=>h.value=C),modelModifiers:{trim:!0},placeholder:d(s).newName(d($))},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue","title"])}}})),de=["onClick"],_e={computed:z(w(w({},T(["fileList"])),K(["absolutePath"])),{isLocalDir(){return this.absolutePath("")==="./www/"}}),methods:z(w({},N(["reloadFileList"])),{deleteClick(l){parent.confirm(s.deleteConfirm(l))&&this.api.service.deleteHassFile(this.absolutePath(l)).then(e=>{this.reloadFileList(),this.$toast(e.msg)})},browseClick(l){window.open(`/local/${l}`)},downloadClick(l){const e=this.absolutePath(l);const i=`/${"ha_file_explorer"}-download?act=download_file&path=${encodeURIComponent(e)}`;const u=document.createElement("a");u.style.display="none";u.href=i;u.download=l.split("/").pop();document.body.appendChild(u);u.click();setTimeout(()=>{document.body.removeChild(u)},100)},renameClick(l){this.$dialog(G,{type:"file",name:l})},editClick(l){let e=l.lastIndexOf(".");if(e>0){let i=l.substring(e+1);if(["db","db-shm","db-wal","pyc"].includes(i)){this.$toast("\u6587\u4EF6\u683C\u5F0F\u4E0D\u652F\u6301\u7F16\u8F91");return}}this.$router.push({name:"editor",params:{name:l}})},addClick(){this.$dialog(M,{type:"file"})},uploadClick(){this.$dialog(O,{type:"file"})}})},pe=A(z(w({},_e),{name:"FileList",setup(l){return(e,i)=>{const u=n("va-button"),$=n("va-button-group"),L=n("va-button-dropdown"),v=n("va-card-title"),h=n("mdi-icon"),f=n("va-avatar"),k=n("va-list-item-section"),y=n("va-list-item-label"),c=n("va-chip"),r=n("va-list-item"),m=n("va-list"),b=n("va-card-content"),V=n("va-card");return p(),g(V,null,{default:t(()=>[a(v,null,{default:t(()=>[_(o(d(s).file)+" ",1),a(L,{outline:"",size:"small"},{default:t(()=>[a($,{size:"small"},{default:t(()=>[a(u,{onClick:e.uploadClick},{default:t(()=>[_(o(d(s).upload),1)]),_:1},8,["onClick"]),a(u,{onClick:e.addClick},{default:t(()=>[_(o(d(s).add),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(b,null,{default:t(()=>[a(m,{style:{"padding-top":"0"}},{default:t(()=>[(p(!0),P(j,null,S(e.fileList,(F,C)=>(p(),g(r,{key:C},{default:t(()=>[a(k,{avatar:""},{default:t(()=>[a(f,{color:"var(--va-primary)"},{default:t(()=>[a(h,{name:F.icon},null,8,["name"])]),_:2},1024)]),_:2},1024),a(k,null,{default:t(()=>[a(y,null,{default:t(()=>[x("a",{href:"javascript:;",onClick:U=>e.editClick(F.name),class:"link"},o(F.name),9,de)]),_:2},1024),a(y,{caption:""},{default:t(()=>[_(o(F.time)+" ",1),F.size?(p(),g(c,{key:0,flat:"",size:"small"},{default:t(()=>[_(o(F.size),1)]),_:2},1024)):B("",!0)]),_:2},1024)]),_:2},1024),a(k,{icon:""},{default:t(()=>[a(L,{size:"small"},{default:t(()=>[a($,{outline:"",size:"small"},{default:t(()=>[e.isLocalDir?(p(),g(u,{key:0,onClick:U=>e.browseClick(F.name)},{default:t(()=>[_(o(d(s).browse),1)]),_:2},1032,["onClick"])):B("",!0),a(u,{onClick:U=>e.downloadClick(F.name)},{default:t(()=>[_("下载",1)]),_:2},1032,["onClick"]),a(u,{onClick:U=>e.renameClick(F.name)},{default:t(()=>[_(o(d(s).rename),1)]),_:2},1032,["onClick"]),a(u,{onClick:U=>e.deleteClick(F.name)},{default:t(()=>[_(o(d(s).delete),1)]),_:2},1032,["onClick"]),a(u,{onClick:U=>e.editClick(F.name)},{default:t(()=>[_(o(d(s).edit),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}));const me=["src","onError"],ve={data(){return{brands:new Array}},computed:w(w({},T(["folderList","path"])),K(["pathList"])),methods:z(w({},N(["getFileList"])),{showClick(l){this.getFileList(l.name)},downloadClick(l){const e=this.path+"/"+l.name;const i=`/${"ha_file_explorer"}-download?act=download_folder&path=${encodeURIComponent(e)}`;const u=document.createElement("a");u.style.display="none";u.href=i;u.download=l.name+".zip";document.body.appendChild(u);u.click();setTimeout(()=>{document.body.removeChild(u)},100)},downloadCurrentFolder(){const{pathList:l}=this,{name:e}=l[l.length-1];const i=this.path;const u=`/${"ha_file_explorer"}-download?act=download_folder&path=${encodeURIComponent(i)}`;const $=document.createElement("a");$.style.display="none";$.href=u;$.download=e+".zip";document.body.appendChild($);$.click();setTimeout(()=>{document.body.removeChild($)},100)},addClick(){this.$dialog(M,{type:"dir"})},uploadClick(){this.$dialog(O,{type:"dir"})},deleteClick(){const{pathList:l}=this,{name:e}=l[l.length-1];parent.confirm(`\u786E\u5B9A\u5220\u9664\u6587\u4EF6\u5939\u3010${e}\u3011\uFF1F`)&&this.api.service.deleteHassFile(this.path).then(i=>{this.getFileList(l.length-2),this.$toast(i.msg)})},renameClick(){this.$dialog(G,{type:"dir",name:""})},loadSrc(l){return this.brands.includes(l)?"https://brands.home-assistant.io/_/homeassistant/icon.png":l},loadIcon(l,e){this.brands.push(e),l.target.src="https://brands.home-assistant.io/_/homeassistant/icon.png"}})},fe=A(z(w({},ve),{name:"FolderList",setup(l){return(e,i)=>{const u=n("va-button"),$=n("va-button-group"),L=n("va-button-dropdown"),v=n("va-card-title"),h=n("mdi-icon"),f=n("va-avatar"),k=n("va-list-item-section"),y=n("va-list-item-label"),c=n("va-chip"),r=n("va-icon"),m=n("va-list-item"),b=n("va-list"),V=n("va-card-content"),F=n("va-card");return p(),g(F,null,{default:t(()=>[a(v,null,{default:t(()=>[_(o(d(s).folder)+" ",1),a(L,{outline:"",size:"small"},{default:t(()=>[a($,{size:"small"},{default:t(()=>[e.pathList.length>1?(p(),g(u,{key:0,onClick:e.renameClick},{default:t(()=>[_(o(d(s).rename),1)]),_:1},8,["onClick"])):B("",!0),a(u,{onClick:e.uploadClick},{default:t(()=>[_(o(d(s).upload),1)]),_:1},8,["onClick"]),e.pathList.length>1?(p(),g(u,{key:1,onClick:e.downloadCurrentFolder},{default:t(()=>[_("下载",1)]),_:1},8,["onClick"])):B("",!0),e.pathList.length>1?(p(),g(u,{key:2,onClick:e.deleteClick},{default:t(()=>[_(o(d(s).delete),1)]),_:1},8,["onClick"])):B("",!0),a(u,{onClick:e.addClick},{default:t(()=>[_(o(d(s).add),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(V,null,{default:t(()=>[a(b,{style:{"padding-top":"0"}},{default:t(()=>[(p(!0),P(j,null,S(e.folderList,(C,U)=>(p(),g(m,{key:U},{default:t(()=>[a(k,{avatar:""},{default:t(()=>[C.iconType=="img"?(p(),P("img",{key:0,class:"brands",src:e.loadSrc(C.icon),onError:I=>e.loadIcon(I,C.icon)},null,40,me)):(p(),g(f,{key:1,color:"var(--va-primary)"},{default:t(()=>[a(h,{name:C.icon},null,8,["name"])]),_:2},1024))]),_:2},1024),a(k,null,{default:t(()=>[a(y,null,{default:t(()=>[_(o(C.name),1)]),_:2},1024),a(y,{caption:""},{default:t(()=>[_(o(C.time)+" ",1),C.size?(p(),g(c,{key:0,flat:"",size:"small"},{default:t(()=>[_(o(C.size),1)]),_:2},1024)):B("",!0)]),_:2},1024)]),_:2},1024),a(k,{icon:""},{default:t(()=>[a(L,{size:"small"},{default:t(()=>[a($,{outline:"",size:"small"},{default:t(()=>[a(u,{onClick:I=>e.downloadClick(C)},{default:t(()=>[_("下载",1)]),_:2},1032,["onClick"]),a(u,{onClick:I=>e.showClick(C)},{default:t(()=>[_("查看",1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}));var he=te(fe,[["__scopeId","data-v-6c86ffe1"]]);const ke={class:"row"},be={class:"flex md6"},Ce={class:"flex md6"},ge={computed:w({},K(["pathList"])),created(){this.changePathClick(0)},methods:z(w({},N(["getFileList"])),{changePathClick(l){this.getFileList(l)},versionClick(){this.$dialog(ie)}})},we=A(z(w({},ge),{name:"index",setup(l){return(e,i)=>{const u=n("va-button"),$=n("va-breadcrumbs-item"),L=n("va-breadcrumbs"),v=n("va-card-title"),h=n("va-card"),f=n("va-backtop");return p(),g(ae,{class:"views-index"},{left:t(()=>[a(u,{color:"#fff",flat:"",rounded:!1,onClick:e.versionClick},{default:t(()=>[_(o(d(s).name),1)]),_:1},8,["onClick"])]),right:t(()=>[]),default:t(()=>[a(h,null,{default:t(()=>[a(v,null,{default:t(()=>[a(L,null,{default:t(()=>[(p(!0),P(j,null,S(e.pathList,(k,y)=>(p(),g($,{label:k.name,key:y,onClick:c=>e.changePathClick(y)},null,8,["label","onClick"]))),128))]),_:1})]),_:1})]),_:1}),x("div",ke,[x("div",be,[a(he)]),x("div",Ce,[a(pe)])]),a(f,{target:"#va-app-bar-shadow","vertical-offset":"20px","horizontal-offset":"20px","visibility-height":1,speed:50})]),_:1})}}}));export{we as default};
